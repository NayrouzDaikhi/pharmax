<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <style>
        body { font-family: DejaVu Sans, Arial, Helvetica, sans-serif; font-size: 12px; color: #333 }
        .header { display:flex; justify-content:space-between; align-items:center; margin-bottom:20px }
        .company { text-align:right }
        table { width:100%; border-collapse: collapse; margin-top:10px }
        th, td { border:1px solid #ddd; padding:8px }
        th { background:#f6f6f6; text-align:left }
        .right { text-align:right }
        .total { font-weight:700; font-size:14px }
    </style>
</head>
<body>
    <div class="header">
        <div>
            <h2>Facture / Commande</h2>
            <div>Commande #: {{ commande.id }}</div>
            <div>Date: {{ commande.createdAt ? commande.createdAt|date('d/m/Y H:i') : 'N/A' }}</div>
        </div>
        <div class="company">
            <div><strong>Pharmax</strong></div>
            <div>Contact: contact@pharmax.example</div>
        </div>
    </div>

    <div>
        <strong>Client:</strong>
        <div>{{ commande.utilisateur ? commande.utilisateur.email : 'Client Anonyme' }}</div>
    </div>

    <table>
        <thead>
            <tr>
                <th>Produit</th>
                <th class="right">Prix (TND)</th>
                <th class="right">Quantit√©</th>
                <th class="right">Sous-total (TND)</th>
            </tr>
        </thead>
        <tbody>
        {% if commande.lignes is defined and commande.lignes|length > 0 %}
            {% for ligne in commande.lignes %}
                <tr>
                    <td>{{ ligne.nom }}</td>
                    <td class="right">{{ ligne.prix|number_format(2, ',', ' ') }}</td>
                    <td class="right">{{ ligne.quantite }}</td>
                    <td class="right">{{ ligne.sousTotal|number_format(2, ',', ' ') }}</td>
                </tr>
            {% endfor %}
        {% elseif commande.produits is iterable %}
            {% for p in commande.produits %}
                <tr>
                    <td>{{ p.nom ?: p }}</td>
                    <td class="right">{{ p.prix|default(0)|number_format(2, ',', ' ') }}</td>
                    <td class="right">{{ p.quantite|default(1) }}</td>
                    <td class="right">{{ (p.prix|default(0) * p.quantite|default(1))|number_format(2, ',', ' ') }}</td>
                </tr>
            {% endfor %}
        {% else %}
            <tr><td colspan="4">Pas de lignes de commande disponibles.</td></tr>
        {% endif %}
        </tbody>
        <tfoot>
            <tr>
                <td colspan="3" class="right total">Total</td>
                <td class="right total">{{ commande.totales|number_format(2, ',', ' ') }} TND</td>
            </tr>
        </tfoot>
    </table>

    <div style="margin-top:30px; font-size:11px; color:#666">Merci pour votre commande.</div>

    {% if qrCode %}
    <div style="margin-top:30px; text-align:center;">
        <div style="font-size:12px; font-weight:bold; margin-bottom:10px;">Code QR</div>
        <img src="{{ qrCode }}" alt="QR Code" style="width:100px; height:100px;">
    </div>
    {% endif %}
</body>
</html>
