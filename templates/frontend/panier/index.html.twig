{% extends 'front_base.html.twig' %}

{% block title %}Mon Panier - Pharmax{% endblock %}

{% block content %}
<!-- Panier Header -->
<section style="background: linear-gradient(135deg, #27ae60 0%, #3498db 100%); color: white; padding: 40px 0; margin-bottom: 40px;">
    <div class="container-xxl">
        <div class="d-flex align-items-center gap-3">
            <i class="bx bx-shopping-bag" style="font-size: 2.5rem;"></i>
            <div>
                <h1 class="display-5 fw-bold mb-0">Mon Panier</h1>
                <p class="fs-5 mb-0 opacity-75">Gérez vos articles avant de passer commande</p>
            </div>
        </div>
    </div>
</section>

<div class="container-xxl mb-5">
    {% if panier|length == 0 %}
    <!-- Panier Vide -->
    <div class="text-center py-5">
        <div style="font-size: 4rem; color: #e0e0e0; margin-bottom: 20px;">
            <i class="bx bx-shopping-bag"></i>
        </div>
        <h3 class="text-muted mb-3">Votre panier est vide</h3>
        <p class="text-muted mb-4">Aucun produit n'a été ajouté à votre panier pour le moment.</p>
        <a href="{{ path('app_front_produits') }}" class="btn btn-primary btn-lg">
            <i class="bx bx-store"></i> Continuer les achats
        </a>
    </div>
    {% else %}
    <!-- Panier Rempli -->
    <div class="row g-4">
        <!-- Colonne Gauche - Articles du Panier -->
        <div class="col-lg-8">
            <div class="card border-0 shadow-sm" style="border-radius: 12px;">
                <div class="card-body p-4">
                    <h5 class="card-title fw-bold mb-4">Vos Articles ({{ panier|length }})</h5>
                    
                    {% set total = 0 %}
                    {% for id, item in panier %}
                    {% set subtotal = item.prix * item.quantite %}
                    
                    <!-- Article Card -->
                    <div class="d-flex gap-3 pb-4 mb-4" style="border-bottom: 1px solid #e9e9e9;">
                        <!-- Image Produit -->
                        <div style="flex-shrink: 0;">
                            {% if item.image %}
                                <img src="{{ asset('uploads/images/' ~ item.image) }}" 
                                     alt="{{ item.nom }}" 
                                     style="width: 100px; height: 100px; object-fit: cover; border-radius: 8px; background: #f5f5f5;"
                                     onerror="this.src='{{ asset('sneat/assets/img/illustrations/boy-with-rocket.png') }}'">
                            {% else %}
                                <div style="width: 100px; height: 100px; background: #f5f5f5; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                                    <i class="bx bx-box" style="font-size: 1.5rem; color: #ccc;"></i>
                                </div>
                            {% endif %}
                        </div>

                        <!-- Détails Produit -->
                        <div class="flex-grow-1">
                            <h6 class="fw-bold mb-2">{{ item.nom }}</h6>
                            <div class="row align-items-center g-2">
                                <!-- Prix -->
                                <div class="col-auto">
                                    <span class="text-primary fw-bold" style="font-size: 1.1rem;">
                                        {{ item.prix|number_format(2, ',', ' ') }} DT
                                    </span>
                                </div>
                                
                                <!-- Quantité -->
                                <div class="col-auto">
                                    <div class="input-group" style="width: 120px;">
                                        <a href="{{ path('app_panier_diminuer', {'id': id}) }}"
                                        class="btn btn-outline-secondary btn-sm">
                                            <i class="bx bx-minus"></i>
                                        </a>

                                        <input type="text"
                                            class="form-control form-control-sm text-center"
                                            value="{{ item.quantite }}"
                                            readonly
                                            style="background: #f5f5f5;">

                                        <a href="{{ path('app_panier_augmenter', {'id': id}) }}"
                                        class="btn btn-outline-secondary btn-sm">
                                            <i class="bx bx-plus"></i>
                                        </a>
                                    </div>
                                </div>

                                <!-- Sous-total -->
                                <div class="col-auto ms-auto text-end">
                                    <p class="mb-0 text-muted" style="font-size: 0.9rem;">Sous-total</p>
                                    <p class="mb-0 fw-bold" style="font-size: 1.1rem;">
                                        {{ subtotal|number_format(2, ',', ' ') }} DT
                                    </p>
                                </div>
                            </div>
                        </div>

                        <!-- Bouton Supprimer -->
                        <div class="text-end" style="flex-shrink: 0;">
                            <a href="{{ path('app_panier_retirer', {'id': id}) }}" 
                               class="btn btn-sm btn-outline-danger" 
                               title="Supprimer cet article">
                                <i class="bx bx-trash"></i>
                            </a>
                        </div>
                    </div>
                    
                    {% set total = total + subtotal %}
                    {% endfor %}

                    <!-- Bouton Continuer les Achats -->
                    <div class="mt-4 pt-3">
                        <a href="{{ path('app_front_produits') }}" class="btn btn-outline-primary">
                            <i class="bx bx-left-arrow-alt"></i> Continuer les achats
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Colonne Droite - Résumé de Commande (Sidebar) -->
        <div class="col-lg-4">
            <!-- Résumé Card -->
            <div class="card border-0 shadow-sm" style="border-radius: 12px; position: sticky; top: 20px;">
                <div class="card-body p-4">
                    <h5 class="card-title fw-bold mb-4">Résumé de Commande</h5>

                    <!-- Détails -->
                    <div class="mb-4">
                        <div class="d-flex justify-content-between mb-3 pb-3" style="border-bottom: 1px solid #e9e9e9;">
                            <span class="text-muted">Sous-total ({{ panier|length }} article{{ panier|length > 1 ? 's' : '' }})</span>
                            <span class="fw-bold">{{ total|number_format(2, ',', ' ') }} DT</span>
                        </div>
                        
                        <div class="d-flex justify-content-between mb-3 pb-3" style="border-bottom: 1px solid #e9e9e9;">
                            <span class="text-muted">Frais de livraison</span>
                            <span class="badge bg-success">Gratuit</span>
                        </div>

                        <div class="d-flex justify-content-between mb-3 pb-3" style="border-bottom: 1px solid #e9e9e9;">
                            <span class="text-muted">TVA (19%)</span>
                            <span class="fw-bold">{{ (total * 0.19)|number_format(2, ',', ' ') }} DT</span>
                        </div>
                    </div>

                    <!-- Total -->
                    <div class="bg-light p-3 rounded-3 mb-4">
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="fw-bold">Total TTC</span>
                            <div style="font-size: 1.5rem; color: #27ae60;" class="fw-bold">
                                {{ (total * 1.19)|number_format(2, ',', ' ') }} DT
                            </div>
                        </div>
                    </div>

                    <!-- Boutons d'Action -->
                    <form method="POST" action="{{ path('app_panier_commander') }}" class="mb-3">
                        <input type="hidden" name="_token" value="{{ csrf_token('panier_commander') }}">
                        <button type="submit" class="btn btn-success w-100 py-3 fw-bold" style="font-size: 1.1rem; background: linear-gradient(135deg, #27ae60 0%, #229954 100%); border: none; box-shadow: 0 4px 8px rgba(39, 174, 96, 0.2); transition: all 0.3s ease;">
                            <i class="bx bx-check-circle"></i> Passer la Commande
                        </button>
                    </form>

                    <a href="{{ path('app_panier_vider') }}" 
                       class="btn btn-outline-danger w-100 py-2"
                       onclick="return confirm('Êtes-vous sûr de vouloir vider le panier ?');">
                        <i class="bx bx-trash"></i> Vider le Panier
                    </a>

                    <!-- Info de Sécurité -->
                    <div class="alert alert-info mt-4 mb-0" style="border-radius: 8px; border: 1px solid #d1ecf1;">
                        <div class="d-flex gap-2 align-items-start">
                            <i class="bx bx-lock-alt" style="font-size: 1.2rem; color: #0c5460;"></i>
                            <small style="color: #0c5460;">
                                Vos paiements sont sécurisés avec les dernières technologies de chiffrement.
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}
