<html>
<body style="font-family: Arial, Helvetica, sans-serif; color:#333;">
    <h2>Confirmation de votre commande #{{ commande.id }}</h2>

    <p>Bonjour{% if commande.utilisateur %} {{ commande.utilisateur.email }}{% endif %},</p>
    <p>Merci pour votre commande. Voici le récapitulatif :</p>

    <table style="width:100%; border-collapse:collapse;">
        <thead>
            <tr>
                <th style="border:1px solid #ddd; padding:6px; text-align:left">Produit</th>
                <th style="border:1px solid #ddd; padding:6px; text-align:right">Prix (EUR)</th>
                <th style="border:1px solid #ddd; padding:6px; text-align:right">Quantité</th>
                <th style="border:1px solid #ddd; padding:6px; text-align:right">Sous-total (EUR)</th>
            </tr>
        </thead>
        <tbody>
            {% if commande.lignes is defined and commande.lignes|length > 0 %}
                {% for ligne in commande.lignes %}
                    <tr>
                        <td style="border:1px solid #ddd; padding:6px">{{ ligne.nom }}</td>
                        <td style="border:1px solid #ddd; padding:6px; text-align:right">{{ ligne.prix|number_format(2, ',', ' ') }}</td>
                        <td style="border:1px solid #ddd; padding:6px; text-align:right">{{ ligne.quantite }}</td>
                        <td style="border:1px solid #ddd; padding:6px; text-align:right">{{ ligne.sousTotal|number_format(2, ',', ' ') }}</td>
                    </tr>
                {% endfor %}
            {% elseif commande.produits is iterable %}
                {% for p in commande.produits %}
                    <tr>
                        <td style="border:1px solid #ddd; padding:6px">{{ p.nom ?: p }}</td>
                        <td style="border:1px solid #ddd; padding:6px; text-align:right">{{ p.prix|default(0)|number_format(2, ',', ' ') }}</td>
                        <td style="border:1px solid #ddd; padding:6px; text-align:right">{{ p.quantite|default(1) }}</td>
                        <td style="border:1px solid #ddd; padding:6px; text-align:right">{{ (p.prix|default(0) * p.quantite|default(1))|number_format(2, ',', ' ') }}</td>
                    </tr>
                {% endfor %}
            {% else %}
                <tr><td colspan="4" style="padding:6px">Aucun produit listé.</td></tr>
            {% endif %}
        </tbody>
        <tfoot>
            <tr>
                <td colspan="3" style="text-align:right; padding:6px; font-weight:bold">Total</td>
                <td style="text-align:right; padding:6px; font-weight:bold">{{ commande.totales|number_format(2, ',', ' ') }} EUR</td>
            </tr>
        </tfoot>
    </table>

    <p>Numéro de commande: <strong>#{{ commande.id }}</strong></p>
    <p>Date: {{ commande.createdAt ? commande.createdAt|date('d/m/Y H:i') : 'N/A' }}</p>

    <p>Si vous avez des questions, répondez à cet e‑mail ou contactez notre support.</p>

    <p>Cordialement,<br>Pharmax</p>
</body>
</html>
