{% extends "base.html.twig" %}

{% block title %}Modifier Commande #{{ commande.id }} - Pharmax{% endblock %}

{% block content %}
<div class="container-xxl flex-grow-1 container-p-y">
    <h4 class="fw-bold py-3 mb-4">
        <span class="text-muted fw-light">Commande /</span> Modifier #{{ commande.id }}
    </h4>

    <div class="row">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">Modifier la commande</h5>
                </div>
                <div class="card-body">
                    {{ form_start(form) }}
                    
                    <div class="mb-3">
                        {{ form_label(form.utilisateur, 'Utilisateur', {'label_attr': {'class': 'form-label'}}) }}
                        {{ form_widget(form.utilisateur, {'attr': {'class': 'form-select'}}) }}
                        <div class="form-text">Sélectionnez l\'utilisateur pour cette commande</div>
                        {% if form.utilisateur.vars.errors|length > 0 %}
                            <div class="invalid-feedback d-block">
                                {{ form_errors(form.utilisateur) }}
                            </div>
                        {% endif %}
                    </div>

                    <div class="mb-3">
                        {{ form_label(form.produits, 'Produits', {'label_attr': {'class': 'form-label'}}) }}
                        {{ form_widget(form.produits, {'attr': {'class': 'form-control', 'placeholder': 'iPhone 15, MacBook Pro'}}) }}
                        <div class="form-text">Entrez les produits séparés par des virgules</div>
                        {% if form.produits.vars.errors|length > 0 %}
                            <div class="invalid-feedback d-block">
                                {{ form_errors(form.produits) }}
                            </div>
                        {% endif %}
                    </div>

                    <div class="mb-3">
                        {{ form_label(form.totales, 'Montant Total', {'label_attr': {'class': 'form-label'}}) }}
                        <div class="input-group">
                            <span class="input-group-text">TND</span>
                            {{ form_widget(form.totales, {'attr': {'class': 'form-control', 'placeholder': '0.00', 'step': '0.01'}}) }}
                        </div>
                        <div class="form-text">Entrez le montant total de la commande</div>
                        {% if form.totales.vars.errors|length > 0 %}
                            <div class="invalid-feedback d-block">
                                {{ form_errors(form.totales) }}
                            </div>
                        {% endif %}
                    </div>

                    <div class="mb-3">
                        {{ form_label(form.statut, 'Statut', {'label_attr': {'class': 'form-label'}}) }}
                        {{ form_widget(form.statut, {'attr': {'class': 'form-select'}}) }}
                        <div class="form-text">Mettez à jour le statut de la commande</div>
                        {% if form.statut.vars.errors|length > 0 %}
                            <div class="invalid-feedback d-block">
                                {{ form_errors(form.statut) }}
                            </div>
                        {% endif %}
                    </div>

                    <div class="mb-3">
                        {{ form_label(form.created_at, 'Date de création', {'label_attr': {'class': 'form-label'}}) }}
                        <div class="input-group">
                            <span class="input-group-text"><i class="bx bx-calendar"></i></span>
                            {{ form_widget(form.created_at, {'attr': {'class': 'form-control'}}) }}
                        </div>
                        <div class="form-text">Date de création de la commande</div>
                        {% if form.created_at.vars.errors|length > 0 %}
                            <div class="invalid-feedback d-block">
                                {{ form_errors(form.created_at) }}
                            </div>
                        {% endif %}
                    </div>

                    <div class="d-flex gap-2">
                        <button type="submit" class="btn btn-primary">
                            <i class="bx bx-check me-1"></i> Modifier
                        </button>
                        <a href="{{ path('app_commande_show', {'id': commande.id}) }}" class="btn btn-secondary">
                            <i class="bx bx-x me-1"></i> Annuler
                        </a>
                    </div>

                    {{ form_end(form) }}
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card bg-light">
                <div class="card-header">
                    <h5 class="card-title mb-0">Informations</h5>
                </div>
                <div class="card-body small">
                    <p><strong>ID Commande:</strong> #{{ commande.id }}</p>
                    <p><strong>Créée le:</strong> {{ commande.createdAt|date('d/m/Y H:i') }}</p>
                    <p class="mb-0"><strong>Utilisateur:</strong> {{ commande.utilisateur ? commande.utilisateur.email : 'N/A' }}</p>
                </div>
            </div>

            <div class="card mt-3">
                <div class="card-header">
                    <h5 class="card-title mb-0">Statut Actuel</h5>
                </div>
                <div class="card-body">
                    {% if commande.statut == 'Completed' %}
                        <span class="badge bg-success p-2">✓ Complétée</span>
                    {% elseif commande.statut == 'Pending' %}
                        <span class="badge bg-warning p-2">⏳ En attente</span>
                    {% elseif commande.statut == 'Cancelled' %}
                        <span class="badge bg-danger p-2">✕ Annulée</span>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
